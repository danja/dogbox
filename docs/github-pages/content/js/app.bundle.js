/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";class t{constructor(){this.listeners=new Map}on(t,e){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e),()=>{const n=this.listeners.get(t);n&&(n.delete(e),0===n.size&&this.listeners.delete(t))}}emit(t,e){const n=this.listeners.get(t);n&&n.forEach((t=>{try{t(e)}catch(t){}}))}removeAllListeners(t){t?this.listeners.delete(t):this.listeners.clear()}}const e=new t;e.on.bind(e),e.emit.bind(e);var n="note:on",i="note:off",r="param:change",o=new t;function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,u(i.key),i)}}function u(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}var c=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioContext=e,this.rd=.8,this.jitter=0,this.shimmer=0,this.f0=220,this.osc=e.createOscillator(),this.osc.type="sawtooth",this.osc.frequency.setValueAtTime(this.f0,e.currentTime),this.gain=e.createGain(),this.gain.gain.value=0,this.osc.connect(this.gain),this.osc.start(),this.gain.gain.value=.5,this.activeNotes=new Map,this.setupEventListeners(),console.log("LFGlottalSource initialized")},e=[{key:"setupEventListeners",value:function(){var t=this;o.on(r,(function(e){var n,i=e.param,r=e.value;try{var o=parseFloat(r),a=t.audioContext.currentTime;switch(i){case"pitch":t.f0=o,t.osc.frequency.cancelScheduledValues(a),t.osc.frequency.setValueAtTime(o,a);break;case"jitter":t.jitter=o;break;case"shimmer":t.shimmer=o;break;case"amp":case"gain":t.gain.gain.cancelScheduledValues(a),t.gain.gain.setValueAtTime(o,a);break;case"amp-attack":case"amp-decay":case"amp-sustain":case"amp-release":null!==(n=t.envelope)&&void 0!==n&&n.setParam&&t.envelope.setParam(i,o)}}catch(t){}})),o.on(n,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.frequency,i=e.velocity,r=void 0===i?.7:i,o=e.time,a=e.id;t.noteOn(o,r,n,a)})),o.on(i,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.time,i=e.id;t.noteOff(n,i)}))}},{key:"setFrequency",value:function(t){this.f0=t,this.osc.frequency.setValueAtTime(t*(1+(2*Math.random()-1)*this.jitter),this.audioContext.currentTime)}},{key:"connect",value:function(t){this.gain.connect(t)}},{key:"disconnect",value:function(){this.gain.disconnect()}},{key:"noteOn",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioContext.currentTime,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;try{if(!this.audioContext)return void console.error("AudioContext not available");var r=this.audioContext.currentTime,o=Math.max(r,t),a=this.audioContext.createGain();a.gain.value=0,this.osc.disconnect(),this.osc.connect(a),a.connect(this.gain),n?this.setFrequency(n):n=this.f0;var s=1+(2*Math.random()-1)*(this.shimmer||0),u=Math.min(1,e*s);console.log("NoteOn [".concat(i||"unknown","]: time=").concat(t.toFixed(3),", freq=").concat(n,", vel=").concat(e,", amp=").concat(u.toFixed(3))),a.gain.cancelScheduledValues(r),a.gain.setValueAtTime(0,r),o>r?(a.gain.linearRampToValueAtTime(0,o),a.gain.linearRampToValueAtTime(u,o+.01)):a.gain.linearRampToValueAtTime(u,r+.01),i&&this.activeNotes.set(i,{gain:a,startTime:r})}catch(t){console.error("Error in noteOn:",t)}}},{key:"noteOff",value:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===(t=this.audioContext)||void 0===t?void 0:t.currentTime,i=arguments.length>1?arguments[1]:void 0;try{if(!this.audioContext)return void console.error("AudioContext not available in noteOff");var r=this.audioContext.currentTime,o=Math.max(r,n||r);if(i&&this.activeNotes.has(i)){var a=this.activeNotes.get(i).gain.gain,s=a.value;console.log("NoteOff [".concat(i,"]: time=").concat(o.toFixed(3),", currentValue=").concat(s.toFixed(3))),a.cancelScheduledValues(r),a.setValueAtTime(s,r),o>r?(a.linearRampToValueAtTime(s,o),a.linearRampToValueAtTime(0,o+.1)):a.linearRampToValueAtTime(0,r+.1),setTimeout((function(){e.activeNotes.has(i)&&(e.activeNotes.get(i).gain.disconnect(),e.activeNotes.delete(i))}),1e3*(o-r+.15))}else if(!i){var u=this.gain.gain,c=u.value;console.log("NoteOff [all]: time=".concat(o.toFixed(3),", currentValue=").concat(c.toFixed(3))),u.cancelScheduledValues(r),u.setValueAtTime(c,r),u.linearRampToValueAtTime(0,o+.1)}}catch(t){console.error("Error in noteOff:",t)}}}],e&&s(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,f(i.key),i)}}function f(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}var d=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioContext=e,this.bufferSize=4096,this.noiseBuffer=this.createNoiseBuffer(),this.gain=e.createGain(),this.gain.gain.value=0,this.noise=e.createBufferSource(),this.noise.buffer=this.noiseBuffer,this.noise.loop=!0,this.filter=e.createBiquadFilter(),this.filter.type="bandpass",this.filter.frequency.setValueAtTime(1e3,e.currentTime),this.filter.Q.value=1,this.gain.gain.value=0,this.noise.connect(this.filter),this.filter.connect(this.gain),this.noise.start(),this.setupEventListeners()},e=[{key:"setupEventListeners",value:function(){var t=this;o.on(r,(function(e){var n=e.param,i=e.value;try{var r=parseFloat(i),o=t.audioContext.currentTime;switch(n){case"breathiness":case"amp":case"gain":t.gain.gain.cancelScheduledValues(o),t.gain.gain.setValueAtTime(r,o);break;case"noiseColor":t.filter.frequency.cancelScheduledValues(o),t.filter.frequency.setValueAtTime(r,o);break;case"noiseQ":case"q":t.filter.Q.cancelScheduledValues(o),t.filter.Q.setValueAtTime(Math.max(.1,r),o)}}catch(t){}})),o.on(n,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.velocity,i=void 0===n?.5:n,r=e.time;t.noteOn(r,i)})),o.on(i,(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).time;t.noteOff(e)}))}},{key:"createNoiseBuffer",value:function(){for(var t=this.audioContext.createBuffer(1,this.bufferSize,this.audioContext.sampleRate),e=t.getChannelData(0),n=0;n<this.bufferSize;n++)e[n]=2*Math.random()-1;return t}},{key:"setFrequency",value:function(t){this.filter.frequency.setValueAtTime(t,this.audioContext.currentTime)}},{key:"setQ",value:function(t){this.filter.Q.setValueAtTime(t,this.audioContext.currentTime)}},{key:"setLevel",value:function(t){this.gain.gain.setValueAtTime(t,this.audioContext.currentTime)}},{key:"connect",value:function(t){this.gain.connect(t)}},{key:"disconnect",value:function(){this.gain.disconnect()}},{key:"noteOn",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioContext.currentTime,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=this.audioContext.currentTime,i=Math.max(n,t),r=this.gain.gain;r.cancelScheduledValues(n),r.setValueAtTime(0,n),i>n?(r.linearRampToValueAtTime(0,i),r.linearRampToValueAtTime(e,i+.01)):r.linearRampToValueAtTime(e,n+.01)}},{key:"noteOff",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioContext.currentTime,e=this.audioContext.currentTime,n=Math.max(e,t),i=this.gain.gain,r=i.value;i.cancelScheduledValues(e),i.setValueAtTime(r,e),n>e?(i.linearRampToValueAtTime(r,n),i.linearRampToValueAtTime(0,n+.1)):i.linearRampToValueAtTime(0,e+.1)}},{key:"trigger",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.audioContext.currentTime;this.noteOn(n,t),this.noteOff(n+e)}}],e&&h(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function p(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,g(i.key),i)}}function g(t){var e=function(t){if("object"!=m(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==m(e)?e:e+""}var b=function(){return t=function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioContext=e,this.filters=[],this.gains=[],this.mix=.5,this.input=this.audioContext.createGain(),this.output=this.audioContext.createGain();for(var i=0;i<4;i++){var r=this.audioContext.createBiquadFilter();r.type="bandpass",r.Q.value=10;var o=this.audioContext.createGain();o.gain.value=.25,r.connect(o),this.filters.push(r),this.gains.push(o)}this.setFormants(800,1200,2500,3500),this.dryGain=this.audioContext.createGain(),this.wetGain=this.audioContext.createGain(),this.filters.forEach((function(t){n.input.connect(t)})),this.gains.forEach((function(t){t.connect(n.wetGain)})),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.setMix(this.mix),this.setupEventListeners()},(e=[{key:"setupEventListeners",value:function(){var t=this;o.on(r,(function(e){var n=e.param,i=e.value;"formants"===n?t.setFormants.apply(t,p(i)):"formantQs"===n?t.setBandwidths.apply(t,p(i)):"filterMix"===n&&t.setMix(i)}))}},{key:"setFormants",value:function(t,e,n,i){var r=this;[t,e,n,i].forEach((function(t,e){r.filters[e]&&r.filters[e].frequency.setValueAtTime(t,r.audioContext.currentTime)}))}},{key:"setBandwidths",value:function(t,e,n,i){var r=this;[t,e,n,i].forEach((function(t,e){r.filters[e]&&r.filters[e].Q.setValueAtTime(r.bwToQ(t),r.audioContext.currentTime)}))}},{key:"bwToQ",value:function(t){Math.PI,this.audioContext.sampleRate;var e=Math.pow(2,t/2);return Math.sqrt(e)/(e-1)}},{key:"setGains",value:function(t,e,n,i){var r=this;[t,e,n,i].forEach((function(t,e){r.gains[e]&&r.gains[e].gain.setValueAtTime(t,r.audioContext.currentTime)}))}},{key:"setMix",value:function(t){this.mix=t;var e=this.audioContext.currentTime;this.dryGain.gain.setValueAtTime(1-t,e),this.wetGain.gain.setValueAtTime(t,e)}},{key:"connect",value:function(t){if(t instanceof AudioNode)this.output.connect(t);else{if(!t._input)throw new Error("Cannot connect to destination: not an AudioNode");this.output.connect(t._input)}return t}},{key:"disconnect",value:function(){this.filters.forEach((function(t){return t.disconnect()})),this.gains.forEach((function(t){return t.disconnect()})),this.dryGain&&this.dryGain.disconnect(),this.wetGain&&this.wetGain.disconnect(),this.mixer&&this.mixer.disconnect()}},{key:"numberOfInputs",get:function(){return 1}},{key:"numberOfOutputs",get:function(){return 1}},{key:"connectInput",value:function(t){this.filters.forEach((function(e){t.connect(e)})),t.connect(this.dryGain)}}])&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,S(i.key),i)}}function S(t){var e=function(t){if("object"!=w(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}var E=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.attack=.01,this.decay=.1,this.sustain=.5,this.release=.2,this.setupEventListeners()},(e=[{key:"setupEventListeners",value:function(){var t=this;o.on(r,(function(e){var n=e.param,i=e.value;if(n.startsWith("amp-")){var r=n.split("-")[1];t[r]=i}}))}},{key:"setADSR",value:function(t,e,n,i){this.attack=t,this.decay=e,this.sustain=n,this.release=i}},{key:"applyEnvelope",value:function(t,e,n,i,r,o){var a=t.context.currentTime,s=r+this.attack,u=s+this.decay,c=r+o-this.release;return t.cancelScheduledValues(a),t.setValueAtTime(e,r),t.linearRampToValueAtTime(n,s),t.linearRampToValueAtTime(i,u),c>u&&t.linearRampToValueAtTime(i,c),t.linearRampToValueAtTime(0,r+o),r+o}}])&&x(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function T(t){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T(t)}function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return C(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function A(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,P(i.key),i)}}function P(t){var e=function(t){if("object"!=T(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=T(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==T(e)?e:e+""}var j=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);try{if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("Web Audio API is not supported in this browser");var e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.envelope=new E,this.glottis=new c(this.audioContext),this.noise=new d(this.audioContext),this.formants=new b(this.audioContext),this.output=this.audioContext.createGain(),this.output.gain.value=.5,this.mixer=this.audioContext.createGain(),this.mixer.gain.value=1,this.glottis.connect(this.mixer),this.noise.connect(this.mixer),this.mixer.connect(this.formants.input),this.formants.connect(this.output),this.output.connect(this.audioContext.destination),this.output.gain.value=.5,this.activeNotes=new Set}catch(t){throw console.error("Error initializing DogSynthesizer:",t),t}this.params={pitch:220,jitter:.05,shimmer:.1,breathiness:.2,noiseColor:1e3,formants:[800,1200,2500,3500],formantQs:[10,8,6,4],"amp-attack":.01,"amp-decay":.1,"amp-sustain":.5,"amp-release":.2},this.updateParams(),this.setupEventListeners(),o.emit("audio:ready")},e=[{key:"setupEventListeners",value:function(){var t=this;o.on(r,(function(e){var n=e.param,i=e.value;t.setParam(n,i)})),o.on("preset:load",(function(e){t.loadPreset(e)}))}},{key:"setParam",value:function(t,e){var n;if(this.params.hasOwnProperty(t))try{var i,a="number"==typeof this.params[t]?parseFloat(e):e,s=this.params[t];if("number"==typeof a&&Math.abs(a-s)<1e-4)return;this.params[t]=a;var u=(null===(i=this.audioContext)||void 0===i?void 0:i.currentTime)||0;switch(t){case"pitch":case"jitter":case"shimmer":this.glottis&&this.glottis.setParam(t,a);break;case"breathiness":case"noiseColor":case"noiseQ":case"q":this.noise&&this.noise.setParam(t,a);break;case"formants":this.formants&&(this.formants.setParam(t,a),this.updateFormants());break;case"amp":case"gain":this.output&&(this.output.gain.cancelScheduledValues(u),this.output.gain.setValueAtTime(a,u));break;default:null!==(n=this.envelope)&&void 0!==n&&n.setParam&&this.envelope.setParam(t,a)}o.emit(r,{param:t,value:a})}catch(t){}}},{key:"updateParams",value:function(){var t=this;Object.entries(this.params).forEach((function(e){var n=k(e,2),i=n[0],r=n[1];t.glottis&&"function"==typeof t.glottis.setParam&&t.glottis.setParam(i,r),t.noise&&"function"==typeof t.noise.setParam&&t.noise.setParam(i,r),t.formants&&"function"==typeof t.formants.setParam&&t.formants.setParam(i,r)})),this.updateFormants()}},{key:"updateFormants",value:function(){o.emit(r,{param:"formants",value:this.params.formants}),o.emit(r,{param:"formantQs",value:this.params.formantQs})}},{key:"loadPreset",value:function(t){var e=this;Object.entries(t).forEach((function(t){var n=k(t,2),i=n[0],a=n[1];e.params.hasOwnProperty(i)&&(e.params[i]=a,o.emit(r,{param:i,value:a}))}))}},{key:"playNote",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.7;try{if(!this.audioContext)return void console.error("Cannot play note: AudioContext not available");var a=this.audioContext.currentTime,s=a+Math.max(.1,e),u="".concat(a,"-").concat(Math.random().toString(36).substr(2,9));console.log("Playing note [".concat(u,"]: duration=").concat(e,"s, velocity=").concat(r,", pitch=").concat(this.params.pitch,"Hz")),this.activeNotes.add(u),o.emit(n,{frequency:this.params.pitch,velocity:r,time:a,id:u});var c=setTimeout((function(){t.activeNotes.has(u)&&(o.emit(i,{time:t.audioContext.currentTime,id:u}),t.activeNotes.delete(u))}),1e3*(s-a));this.activeNotes.add({id:u,timeout:c,cancel:function(){return clearTimeout(c)}}),console.log("Scheduled note off [".concat(u,"] at: ").concat(s.toFixed(3),"s"))}catch(t){console.error("Error in playNote:",t)}}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"disconnect",value:function(){this.glottis.disconnect(),this.noise.disconnect(),this.formants.disconnect(),this.output.disconnect()}}],e&&A(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(t,e)||z(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){if(t){if("string"==typeof t)return I(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function B(){B=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(t,e,n,i){Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i})}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(e,n,i,r){var o=n&&n.prototype instanceof f?n:f,a=Object.create(o.prototype);return u(a,"_invoke",function(e,n,i){var r=1;return function(o,a){if(3===r)throw Error("Generator is already running");if(4===r){if("throw"===o)throw a;return{value:t,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var u=x(s,i);if(u){if(u===h)continue;return u}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(1===r)throw r=4,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=3;var c=l(e,n,i);if("normal"===c.type){if(r=i.done?4:2,c.arg===h)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=4,i.method="throw",i.arg=c.arg)}}}(e,i,new T(r||[])),!0),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h={};function f(){}function d(){}function m(){}var p={};u(p,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(k([])));v&&v!==n&&i.call(v,o)&&(p=v);var g=m.prototype=f.prototype=Object.create(p);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function n(r,o,a,s){var u=l(t[r],t,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==O(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var r;u(this,"_invoke",(function(t,i){function o(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(o,o):o()}),!0)}function x(e,n){var i=n.method,r=e.i[i];if(r===t)return n.delegate=null,"throw"===i&&e.i.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var o=l(r,e.i,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var a=o.arg;return a?a.done?(n[e.r]=a.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function S(t){this.tryEntries.push(t)}function E(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function T(t){this.tryEntries=[[-1]],t.forEach(S,this),this.reset(!0)}function k(e){if(null!=e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(O(e)+" is not iterable")}return d.prototype=m,u(g,"constructor",m),u(m,"constructor",d),u(m,s,d.displayName="GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,u(t,s,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new w(c(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(g),u(g,s,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.unshift(i);return function t(){for(;n.length;)if((i=n.pop())in e)return t.value=i,t.done=!1,t;return t.done=!0,t}},e.values=k,T.prototype={constructor:T,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(t){a.type="throw",a.arg=e,n.next=t}for(var r=n.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o[4],s=this.prev,u=o[1],c=o[2];if(-1===o[0])return i("end"),!1;if(!u&&!c)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<u)return this.method="next",this.arg=t,i(u),!0;if(s<c)return i(c),!1}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i[0]>-1&&i[0]<=this.prev&&this.prev<i[2]){var r=i;break}}r&&("break"===t||"continue"===t)&&r[0]<=e&&e<=r[2]&&(r=null);var o=r?r[4]:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r[2],h):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[2]===t)return this.complete(n[4],n[3]),E(n),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[0]===t){var i=n[4];if("throw"===i.type){var r=i.arg;E(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={i:k(e),r:n,n:i},"next"===this.method&&(this.arg=t),h}},e}function F(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function L(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){F(o,i,r,a,s,"next",t)}function s(t){F(o,i,r,a,s,"throw",t)}a(void 0)}))}}function G(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,N(i.key),i)}}function N(t){var e=function(t){if("object"!=O(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:e+""}var M=function(){return t=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.synth=null,this.initialized=!1,this.initializing=!1,this.isLoadingPreset=!1,this.paramUpdateTimeout=null,this.uiElements={},this.presets=this.getDefaultPresets(),this.loadPreset=this.loadPreset.bind(this),this.playTestSound=this.playTestSound.bind(this),this.initAudio=this.initAudio.bind(this),this.initialize=this.initialize.bind(this),this.onSliderChange=this.onSliderChange.bind(this),this.updateSynthFromSlider=this.updateSynthFromSlider.bind(this),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return e.initialize()})):this.initialize()},e=[{key:"initialize",value:(a=L(B().mark((function t(){var e=this;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{this.setupUIElements(),this.setupEventListeners(),this.uiElements.startBtn.addEventListener("click",(function(){return e.initAudio()})),this.uiElements.testBtn.addEventListener("click",(function(){return e.playTestSound()})),this.updateStatus("Click Initialize to begin","#4facfe"),o.emit("ui:ready")}catch(t){console.error("Error initializing controller:",t),this.updateStatus("Initialization failed. Check console for errors.","#e74c3c")}case 1:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"initAudio",value:(r=L(B().mark((function t(){var e,n,i,r,o=this;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.initializing){t.next=2;break}return t.abrupt("return");case 2:if(this.initializing=!0,t.prev=3,this.updateStatus("Initializing audio...","#4facfe"),console.log("Browser info:",{userAgent:navigator.userAgent,secureContext:window.isSecureContext,hasAudioContext:!(!window.AudioContext&&!window.webkitAudioContext),location:window.location.href}),!1!==window.isSecureContext){t.next=8;break}throw new Error("Page must be served over HTTPS or localhost to use Web Audio API");case 8:if(window.AudioContext||window.webkitAudioContext){t.next=11;break}throw new Error("Web Audio API is not supported in this browser");case 11:if(console.log("Browser info:",{userAgent:navigator.userAgent,secureContext:window.isSecureContext,hasAudioContext:!(!window.AudioContext&&!window.webkitAudioContext),location:window.location.href}),!1!==window.isSecureContext){t.next=14;break}throw new Error("Page must be served over HTTPS or localhost to use Web Audio API");case 14:if(window.AudioContext||window.webkitAudioContext){t.next=16;break}throw new Error("Web Audio API is not supported in this browser");case 16:if(console.log("Creating DogSynthesizer instance..."),this.synth=new j,console.log("AudioContext state:",this.synth.audioContext.state),e=function(){var t=L(B().mark((function t(){return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"suspended"!==o.synth.audioContext.state){t.next=5;break}return console.log("AudioContext is suspended, resuming..."),t.next=5,o.synth.audioContext.resume();case 5:console.log("AudioContext state after resume:",o.synth.audioContext.state),"running"===o.synth.audioContext.state&&(o.initialized=!0,o.initializing=!1,o.uiElements.testBtn.disabled=!1,o.uiElements.startBtn.disabled=!0,o.updateStatus("Audio ready! Click Test or adjust parameters.","#2ecc71"),o.uiElements.testBtn.disabled=!1,o.uiElements.playBtn&&(o.uiElements.playBtn.disabled=!1),setTimeout((function(){o.playTestSound()}),300)),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Error handling audio context state:",t.t0),o.updateStatus("Error initializing audio. Try clicking Initialize again.","#e74c3c"),o.initializing=!1;case 14:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}(),n=function(){var t=L(B().mark((function t(){return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return document.removeEventListener("click",n),document.removeEventListener("keydown",n),document.removeEventListener("touchstart",n),t.prev=3,t.next=6,e();case 6:t.next=13;break;case 8:t.prev=8,t.t0=t.catch(3),console.error("Error in user interaction handler:",t.t0),o.updateStatus("Error enabling audio. Try refreshing the page.","#e74c3c"),o.initializing=!1;case 13:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(){return t.apply(this,arguments)}}(),"running"!==this.synth.audioContext.state){t.next=26;break}return t.next=24,e();case 24:t.next=30;break;case 26:this.updateStatus("Click or tap anywhere to enable audio...","#f39c12"),document.addEventListener("click",n,{once:!0}),document.addEventListener("keydown",n,{once:!0}),document.addEventListener("touchstart",n,{once:!0});case 30:t.next=39;break;case 32:t.prev=32,t.t0=t.catch(3),console.error("Error initializing audio:",t.t0),r="Error initializing audio: "+t.t0.message,t.t0.message.includes("secure context")?r="Audio requires a secure context (HTTPS or localhost)":t.t0.message.includes("Web Audio API")&&(r="Web Audio API not supported in this browser"),this.updateStatus(r,"#e74c3c"),console.log("Browser info:",{userAgent:navigator.userAgent,secureContext:window.isSecureContext,hasAudioContext:!(!window.AudioContext&&!window.webkitAudioContext),audioContextState:null===(i=this.synth)||void 0===i||null===(i=i.audioContext)||void 0===i?void 0:i.state});case 39:case"end":return t.stop()}}),t,this,[[3,32]])}))),function(){return r.apply(this,arguments)})},{key:"setupUIElements",value:function(){var t=this;this.uiElements={startBtn:document.getElementById("startBtn"),testBtn:document.getElementById("testBtn"),playBtn:document.getElementById("playBtn"),status:document.getElementById("status"),sliders:{}},document.querySelectorAll('input[type="range"]').forEach((function(e){t.uiElements.sliders[e.id]=e;var n=document.getElementById("".concat(e.id,"-value"));n&&(n.textContent=e.value)})),this.uiElements.presetBtns=document.querySelectorAll(".preset-btn")}},{key:"setupEventListeners",value:function(){var t=this;Object.entries(this.uiElements.sliders).forEach((function(e){var n=V(e,2),i=n[0];n[1].addEventListener("input",(function(e){return t.onSliderChange(i,e.target.value)}))})),this.uiElements.presetBtns.forEach((function(e){e.addEventListener("click",(function(){return t.loadPreset(e.dataset.preset)}))})),this.uiElements.playBtn&&this.uiElements.playBtn.addEventListener("click",(function(){return t.playTestSound()}))}},{key:"updateSynthFromSlider",value:function(t,e){var n=this;if(this.initialized&&this.synth&&!this.isLoadingPreset){var i=parseFloat(e);this.paramUpdateTimeout&&clearTimeout(this.paramUpdateTimeout),this.paramUpdateTimeout=setTimeout((function(){var e={pitch:"pitch",jitter:"jitter",shimmer:"shimmer",breathiness:"breathiness",noiseColor:"noiseColor",f1:"formants",f2:"formants",f3:"formants","amp-attack":"amp-attack","amp-decay":"amp-decay","amp-sustain":"amp-sustain","amp-release":"amp-release"}[t];if(e)try{if(t.startsWith("f")){var r=parseInt(t[1])-1,o=function(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||z(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n.synth.params.formants);o[r]=i,n.synth.setParam("formants",o)}else n.synth.setParam(e,i)}catch(t){console.error("Error updating parameter:",t)}}),16)}}},{key:"onSliderChange",value:function(t,e){if(this.initialized&&!this.isLoadingPreset){var n=parseFloat(e),i=document.getElementById("".concat(t,"-value"));i&&(i.textContent=n.toFixed(2)),this.updateSynthFromSlider(t,n)}}},{key:"loadPreset",value:function(t){var e=this;if(this.initialized){var n=this.presets[t];if(n){this.paramUpdateTimeout&&(clearTimeout(this.paramUpdateTimeout),this.paramUpdateTimeout=null);try{this.isLoadingPreset=!0;var i=[];Object.entries(n).forEach((function(t){var n,r=V(t,2),o=r[0],a=r[1],s=null===(n=e.uiElements.sliders)||void 0===n?void 0:n[o];if(s){s.value=a;var u=document.getElementById("".concat(o,"-value"));u&&(u.textContent=parseFloat(a).toFixed(2)),i.push({id:o,value:a})}})),i.forEach((function(t){var n=t.id,i=t.value;e.updateSynthFromSlider(n,i)})),this.updateStatus("Loaded preset: ".concat(t),"#9b59b6"),this.playTestSound()}catch(t){console.error("Error loading preset:",t),this.updateStatus("Error loading preset","#e74c3c")}finally{this.isLoadingPreset=!1}}else console.warn("Preset '".concat(t,"' not found"))}else this.updateStatus("Please initialize audio first","#e67e22")}},{key:"playTestSound",value:(i=L(B().mark((function t(){var e;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.synth){t.next=4;break}return console.warn("Cannot play test sound: No synth instance"),this.updateStatus("Audio not ready. Click Initialize first.","#e74c3c"),t.abrupt("return");case 4:if(t.prev=4,"suspended"!==(e=this.synth.audioContext).state){t.next=10;break}return console.log("AudioContext suspended, attempting to resume..."),t.next=10,e.resume();case 10:if("running"===e.state){t.next=14;break}return console.warn("AudioContext could not be resumed, state:",e.state),this.updateStatus("Audio not ready. Try clicking the Play button again.","#e67e22"),t.abrupt("return");case 14:console.log("Playing test sound with params:",{pitch:this.synth.params.pitch,state:e.state}),this.synth.playNote(1,.7),this.updateStatus("Playing test sound...","#2ecc71"),t.next=23;break;case 19:t.prev=19,t.t0=t.catch(4),console.error("Error playing test sound:",t.t0),this.updateStatus("Error playing sound: "+t.t0.message,"#e74c3c");case 23:case"end":return t.stop()}}),t,this,[[4,19]])}))),function(){return i.apply(this,arguments)})},{key:"initializeAudio",value:(n=L(B().mark((function t(){var e=this;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.synth){t.next=5;break}return console.log("Audio already initialized, playing test sound..."),t.next=4,this.playTestSound();case 4:return t.abrupt("return");case 5:return this.updateStatus("Initializing audio...","#f39c12"),t.prev=6,this.synth=new j,t.next=10,new Promise((function(t){var n=function(){e.synth.audioContext&&"running"===e.synth.audioContext.state?t():setTimeout(n,50)};n()}));case 10:return t.next=12,this.playTestSound();case 12:this.updateStatus("Audio initialized!","#2ecc71"),t.next=20;break;case 15:throw t.prev=15,t.t0=t.catch(6),console.error("Error initializing audio:",t.t0),this.updateStatus("Error initializing audio: "+t.t0.message,"#e74c3c"),t.t0;case 20:case"end":return t.stop()}}),t,this,[[6,15]])}))),function(){return n.apply(this,arguments)})},{key:"getDefaultPresets",value:function(){return{bark:{pitch:220,jitter:.05,shimmer:.08,breathiness:.1,noiseColor:1e3,f1:650,f2:1100,f3:2200,"amp-attack":.01,"amp-decay":.05,"amp-sustain":.6,"amp-release":.2},whine:{pitch:450,jitter:.03,shimmer:.04,breathiness:.15,noiseColor:1200,f1:800,f2:1600,f3:2800,"amp-attack":.01,"amp-decay":.1,"amp-sustain":.7,"amp-release":.3},growl:{pitch:120,jitter:.1,shimmer:.12,breathiness:.2,noiseColor:800,f1:500,f2:900,f3:1800,"amp-attack":.05,"amp-decay":.2,"amp-sustain":.8,"amp-release":.4}}}},{key:"updateStatus",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#4facfe";this.uiElements.statusEl&&(this.uiElements.statusEl.textContent=t,this.uiElements.statusEl.style.color=e),console.log("[Status] ".concat(t))}},{key:"logDebug",value:function(t){if(this.uiElements.debugEl){var e=document.createElement("div");for(e.textContent="[".concat((new Date).toISOString(),"] ").concat(t),this.uiElements.debugEl.prepend(e);this.uiElements.debugEl.children.length>10;)this.uiElements.debugEl.removeChild(this.uiElements.debugEl.lastChild)}console.debug("[Debug] ".concat(t))}}],e&&G(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,r,a}();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){new M})):new M,window.app={SynthController:M}})();
//# sourceMappingURL=app.bundle.js.map